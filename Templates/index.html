<!DOCTYPE html>
<html>

<head>
    <title>TensorView</title>
    <link rel="icon" type="image/png" href="/static/favicon.ico">
    <style>
        #table {
            font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
            border-collapse: collapse;
            width: 30%;
        }

        #table td, #table th {
            border: 2px solid #ddd;
            padding: 6px;
        }

        #table tr:nth-child(even) {
            background-color: #F1F3FF;
        }

        #table tr:hover {
            background-color: #ddd;
        }
        .submit {
            background-color: #98fb98; /* Green */
            border: none;
            color: black;
            padding: 12px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            border-radius: 8px;
            -webkit-transition-duration: 0.4s; /* Safari */
            transition-duration: 0.4s;
            cursor: pointer;
        }

        .submit1 {
            background-color: white;
            color: black;
            border: 2px solid #98fb98;
        }
        .submit1:hover {
            background-color: #98fb98;
            color: white;
        }

        #go_button {
            background-color: #98fb98;
            font-size: 14px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Table Name: {{ table_name }}</h1>

    {%  set querey_params = {} %}
    <form action="#" method="post" class="Table_Body" id="table_body" >
{#    action={{ url_for("/", **query_params) }}#}
        <button class="submit submit1" onclick="getOption()">Submit</button>

        <div id="table_rows">

            <table id="table">
                <tbody>
                {# building the headings of the table #}
                <tr>
                    {% for cell in headings %}
                        <td><b>{{ cell }}</b></td>
                    {% endfor %}
                    <td><b>{{ "Graph?"}}</b></td>
                </tr>
                {# making the drop downs for the query selection#}
                <tr>
                    <td><b></b></td>
                    {% for cell in range((headings|length)-1) %}
                        <td><b>
                            <select id = "drop_down_select">
                                {%  if table_contents[0][cell+1] is string %}
                                    <option value=" "> </option>
                                    <option value="contains">Contains</option>
                                    <option value="startsWith">Starts with</option>
                                    <option value="endsWith">Ends with</option>
                                {%  endif %}
                                {%  if table_contents[0][cell+1] is number %}
                                    <option value=" "> </option>
                                    <option value="<">Less than</option>
                                    <option value=">">Greater than</option>
                                    <option value="=">Equal to</option>
                                    <option value=">=">Greater than or equal to</option>
                                    <option value="<=">Less than or equal to</option>
                                {%  endif %}
                                {#            This is where we will do the query string for the sql queries#}
                            </select>
                            <INPUT TYPE="TEXT" NAME="name" SIZE="10" id='user_input'></b></td>
                        {% set my_string = results.user_input %}
{#                        {% set my_string = ret + stuff.id + ', '%}#}
{#                        <p> {{getOption()}}</p>#}
                        {% if "{{ headings[cell] }}" not in query_params %}
{#                                       CONCAT of drop down selection + _ + user input  #}
{#                                          add entry to the map query_params           #}
                            {% do querey_params["{{ headings[cell] }}"]= my_string %}
                        {% endif %}
                    {% endfor %}
                    <td>
                        <b>

                    </b></td>
                </tr>
                {#        filling in the table#}
                {% for row in table_contents %}
                    <tr>

                        {% for cell in range((row|length)) %}
                            <td>{{ row[cell] }}</td>
                        {% endfor %}
                        <td><label><input type="checkbox" value={{ row[0] }} /> </label> </td>
                    </tr>
                {% endfor %}
                <p>
                    <label>Regex: <input type="text" name ="regex" value="()" readonly="readonly" id="regInput"/> </label>
                    <button onclick="copyReg()">Copy Regex</button>
                </p>

                </tbody>
            </table>
        </div>
    </form>
</div>

</body>
<br>
<br>

</html>

<script>

    function attachCheckboxHandlers() {
        // get reference to element containing toppings checkboxes
        var el = document.getElementById('table_rows');

        // get reference to input elements in toppings container element
        var tops = el.getElementsByTagName('input');

        // assign updateTotal function to onclick property of each checkbox
        for (var i=0, len=tops.length; i<len; i++) {
            if ( tops[i].type === 'checkbox' ) {
                tops[i].onclick = updateRegex;
            }
        }
    }

    function updateRegex() {
        // 'this' is reference to checkbox clicked on
        var form = this.form;

        // get current value in total text box, using parseFloat since it is a string
        var currentRegex = form.elements['regex'].value;
        var namesWithPipes = currentRegex.substring(1, currentRegex.length-1);
        if ("()" === currentRegex){
            form.elements['regex'].value = "("+this.value+")";
            return;
        }

        var arr = namesWithPipes.split("|");
        // if check box is checked, add its value to val, otherwise subtract it
        if ( this.checked ) {
            arr.push(this.value);
        } else {
            var ind = arr.indexOf((this.value));
            if(ind !== -1){
                arr.splice(ind,1);
            }
        }

        form.elements['regex'].value = "("+arr.join("|")+")";
    }

    attachCheckboxHandlers();

    function copyReg(){
        var copyText = document.getElementById("regInput");
        copyText.select();
        document.execCommand("copy");
        alert("Copied the text: " + copyText.value + " to clipboard.")
    }

    function getOption(){
        console.log("Anna");
        var opt = document.getElementById("drop_down_select");
        var e = document.getElementById("user_input").value;
        var strOption = opt.options[e.selectedIndex].value;
        var j = strOption.concat("_");
        var ret = j.concat(e);
        console.log(ret);
    }

</script>

{#code for syling used from here#}
{#https://www.w3schools.com/css/tryit.asp?filename=trycss_table_fancy#}


{#https://stackoverflow.com/questions/32516455/how-to-create-url-according-to-the-checked-checkboxes#}
{#https://stackoverflow.com/questions/22505825/creating-string-of-checkbox-ids-if-checked#}
{#https://coderwall.com/p/pkthoa/read-checkbox-in-flask#}
{#https://gist.github.com/devdave/1472832#}
{#https://www.dyn-web.com/tutorials/forms/checkbox/group.php#}